# Sealed Secret for MongoDB credentials
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: mongodb-secret
  namespace: default
spec:
  encryptedData:
    mongodb-uri: AgCfcLm61jw3hOtxmxeRUA/efk/LW4ar0xknc/9UlRlK1u+YqKdlKMbMF7bIxH3v/kOnymgxj9IXgmyUERSCRXBhFthzr514vuV8zWAocWfLzUwvG6x/Gxq8y5sRJGJ2dU9wAFK/fWudRA2fHO7iXkRtp+JS4T0hQKu7ufelOWecBpbpPdfBrTfqDoNCU2DtQwXnwZtxT37sy/WviHYWamLA3enP6DraDqp1ILAnhGaZzJR2qF51QATO6zvAKKONa3O+Q3mgIXbRbQ7Qua8MSXUB4PD78XDX7Ibi8K9Pr01pBu1wupIwJVnS4xNZ+v3nTUlpCGveWZGj0MX8F88aega24gwRYf+Y+VyahpPh3RgR344x+kNT3Lb2SwuUcYwE8nS7QPDJp/f6NR07c+PkYr0Doh1JpfCKjGfEAYkSh+4BWJHclhKaQfh/FcTbbg2+KHSQAZlT8uD2czXL7KrwE61y7YG2CBMeeBbvowUUyqIlGKA+v2DNkYWdbKWUmwrwOQzl3TRFKkpS9cZ6q4JIxFBeu8eZiDo+RNuY+Zrl0GuSy9QZFjl58TjzTXRHBbeHudenFcHRvLfZppuZtXmMQ6yDEahncmPofFIhPhPAv5Ut9fLG1BTTtZ/CxGnhgRLxahwgnzPgek3s3GB90oU9/V8SlAz92ld7bSaNsNl7b6Ufn7JXF93N2pcVBce53thqk0CsiFyawRVhIFPVPhDUECcW/dY1bp4vu0vQjgVcJzE5VkkItT35bMbaCEr2pvFv7oH8L0oVsepfF0Eb2nhs5caVB+n+tqLgCyIOuZ2eth5Adn6lzdLN5A==
  template:
    metadata:
      name: mongodb-secret
      namespace: default
    type: Opaque
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: springboot-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: springboot-app
  template:
    metadata:
      labels:
        app: springboot-app
    spec:
      containers:
        - name: springboot-app
          image: registry.gitlab.com/cinema7590904/service-actor-management:latest
          ports:
            - containerPort: 8080
          env:
            - name: SPRING_DATA_MONGODB_URI
              valueFrom:
                secretKeyRef:
                  name: mongodb-secret
                  key: mongodb-uri
          resources:
            requests:
              ephemeral-storage: "1Gi"
              memory: "256Mi"
              cpu: "250m"
            limits:
              memory: "512Mi"
              cpu: "500m"
---
apiVersion: v1
kind: Service
metadata:
  name: springboot-service
spec:
  selector:
    app: springboot-app
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
  type: NodePort
